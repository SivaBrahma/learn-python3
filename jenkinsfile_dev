pipeline {
   agent {
     kubernetes{
        containerTemplate {
             name 'gradle'
	     image ''
	     ttyEnabled true
	     command 'cat'
	}
     }
  }
  stages{
    stage ('checkout'){
      steps {
        checkout($class: 'GitSCM', branches: [[name: '*/master]], doGenerateSubmoduleConfigurations: false, extensions: [], submodulecfg: [], userRemoteConfigs: [[credentials: '${GIT_CREDENTI        AL_ID}', URL: '${GIT_REPO}']])
      }
    } 
    stage ('build'){
      steps {
        configFileProvider([configFile(fileId: 'maven-managed-config', variable: 'MAVEN_SETTINGS')]){
	sh 'mvn -U clean install pmd:pmd -Dmaven.test.skip=true -Dmaven.javadoc.skip=true -s ${MAVEN_SETTINGS}'
	recordIssues(tools: [pmdParser()])
	archiveArtifacts 'target/*.hpi,target/*.jar'
	}
      }
    }
    stage('synopsys detect'){
      steps {
        setupBlackduckEnvironment()
	synopsys_detect '--detect.tools.excluded=SIGNATURE_SCAN --detect.bom.aggregate.name=${BUILD_NUMBER}_bom --detect.project.version.name=${detectiveVersionName} --detect.project.name="${        ucdComponent}"'
      }
    }
    stage('ucd'){
      steps{
        ucd components: [[basedir: "${WORKSPACE}", componentName: "${ucdComponent}", fileIncludePatterns: ".jar", versionName: "${JOB_NAME}_${BUILD_NUMBER}"]], serverName: "ucd-prod-oi"
      }
    }
  } 
}
